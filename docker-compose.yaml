version: "3"

services:
        web:
                image: nginx
                ports:
                  - "80:80"
                  - "8081:8081"
                volumes:
#                  - ./web:/usr/share/nginx/html
                  - ./web:/var/www/html
                  - ./nginx_conf:/etc/nginx/conf.d

        prometheus:
                image: prom/prometheus
                ports: ["9090:9090"]
                volumes:
                  - ./prometheus:/etc/prometheus/

        nginx_exporter:
                image: nginx/nginx-prometheus-exporter:0.1.0
#                network_mode: "host"
                restart: always
                command:
                  - -nginx.scrape-uri
                  - http://51.250.18.162/nginx_status
                ports:
                  - "9113:9113"

        grafana:
                image: grafana/grafana-enterprise:8.2.0
                ports:
                  - "3000:3000"
                environment:
                  - GF_SECURITY_ADMIN_PASSWORD=Qwerty123
                volumes:
                  - ./grafana/provisioning:/etc/grafana/provisioning
#                  - ./grafana/dashboards:/etc/grafana/dashboards
#                  - ./grafana-data:/var/lib/grafana
        node-exporter:
                image: prom/node-exporter
                volumes:
                  - /proc:/host/proc:ro
                  - /sys:/host/sys:ro
                  - /:/rootfs:ro
                command:
                  - --path.procfs=/host/proc
                  - --path.sysfs=/host/sys
                  - --collector.filesystem.ignored-mount-points
                  - ^/(sys|proc|dev|host|etc|rootfs/var/lib/docker/containers|rootfs/var/lib/docker/overlay2|rootfs/run/docker/netns|rootfs/var/lib/docker/aufs)($$|/)
                ports:
                  - 9100:9100
                restart: always
                deploy:
                  mode: global
